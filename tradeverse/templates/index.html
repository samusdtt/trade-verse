{% extends 'base.html' %}
{% block content %}
<section class="py-3 py-md-4">
	<div class="p-4 p-md-5 rounded-3 bg-gradient-light shadow-xs">
		<div class="row align-items-center g-3">
			<div class="col-lg-8">
				<h1 class="display-6 mb-2">The Trading Education Center</h1>
				<p class="lead text-muted mb-0">Explore backtests, journals, and strategies shared by the TradeVerse community.</p>
			</div>
			<div class="col-lg-4">
				<form class="d-flex" method="get" action="{{ url_for('main.index') }}">
					<input class="form-control me-2" type="search" name="q" value="{{ q or '' }}" placeholder="Search posts" aria-label="Search">
					{% if selected_category %}<input type="hidden" name="category" value="{{ selected_category }}">{% endif %}
					<button class="btn btn-primary" type="submit">Search</button>
				</form>
			</div>
		</div>
	</div>
</section>

<div class="mb-3 d-flex flex-wrap gap-2">
	{% for cat in categories %}
		<a class="badge rounded-pill {% if selected_category==cat.name %}bg-primary{% else %}bg-primary-soft{% endif %} text-decoration-none" href="{{ url_for('main.index', category=cat.name, q=q) }}">{{ cat.name }}</a>
	{% endfor %}
</div>

<div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3">
	{% for p in posts %}
	<div class="col">
		<article class="card h-100 shadow-sm card-hover">
			{% if p.thumbnail_path %}
			<img src="{{ url_for('static', filename=p.thumbnail_path) }}" class="card-thumb" alt="thumbnail" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
			{% endif %}
			{% if not p.thumbnail_path or p.thumbnail_path is none %}
			<div class="default-thumb">
				<span>ðŸ“Š</span>
			</div>
			{% endif %}
			<div class="card-body">
				<div class="d-flex justify-content-between align-items-center mb-1">
					<span class="badge bg-secondary-subtle text-secondary">{{ p.category.name }}</span>
					<small class="text-muted">{{ p.created_at.strftime('%b %d, %Y') }}</small>
				</div>
				<h2 class="h5 card-title"><a class="stretched-link text-decoration-none" href="{{ url_for('posts.detail', post_id=p.id) }}">{{ p.title }}</a></h2>
				<p class="card-text text-muted">{{ p.excerpt or (p.content[:140] ~ '...') }}</p>
			</div>
		</article>
	</div>
	{% else %}
	<div class="col"><div class="text-muted">No posts yet.</div></div>
	{% endfor %}
</div>
{% endblock %}