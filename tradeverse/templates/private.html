{% extends "base.html" %}

{% block title %}Private Section - {{ config.APP_NAME }}{% endblock %}

{% block content %}
<div class="container py-4">
	<!-- Header -->
	<div class="row mb-4">
		<div class="col-lg-8">
			<h1 class="display-6 mb-2">ðŸ”’ Private Section</h1>
			<p class="text-muted">Your private posts and categories - only visible to you</p>
		</div>
		<div class="col-lg-4 text-end">
			<a href="{{ url_for('posts.new_post') }}" class="btn btn-primary">
				<i class="bi bi-plus-circle"></i> New Private Post
			</a>
		</div>
	</div>

	<!-- Search and Filters -->
	<div class="row mb-4">
		<div class="col-lg-8">
			<form method="GET" class="d-flex gap-2">
				<input type="text" name="q" class="form-control" placeholder="Search your private posts..." value="{{ q }}">
				<button type="submit" class="btn btn-outline-primary">
					<i class="bi bi-search"></i>
				</button>
			</form>
		</div>
		<div class="col-lg-4">
			<div class="dropdown">
				<button class="btn btn-outline-secondary dropdown-toggle w-100" type="button" data-bs-toggle="dropdown">
					{% if selected_category %}{{ selected_category }}{% else %}All Categories{% endif %}
				</button>
				<ul class="dropdown-menu">
					<li><a class="dropdown-item" href="{{ url_for('main.private_section') }}">All Categories</a></li>
					{% for category in categories %}
					<li><a class="dropdown-item" href="{{ url_for('main.private_section', category=category.name) }}">{{ category.name }}</a></li>
					{% endfor %}
				</ul>
			</div>
		</div>
	</div>

	<!-- Posts Grid -->
	{% if posts %}
	<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
		{% for post in posts %}
		<div class="col">
			<div class="card h-100 card-hover">
				{% if post.thumbnail_path %}
				<img src="{{ url_for('static', filename=post.thumbnail_path) }}" class="card-thumb" alt="thumbnail">
				{% else %}
				<div class="default-thumb">
					<i class="bi bi-file-text display-4"></i>
				</div>
				{% endif %}
				<div class="card-body">
					<div class="d-flex justify-content-between align-items-start mb-2">
						<span class="badge bg-warning text-dark">{{ post.category.name }}</span>
						<small class="text-muted">{{ post.reading_time }} min read</small>
					</div>
					<h5 class="card-title">{{ post.title }}</h5>
					{% if post.excerpt %}
					<p class="card-text text-muted">{{ post.excerpt }}</p>
					{% endif %}
					<div class="d-flex justify-content-between align-items-center mt-3">
						<div class="d-flex align-items-center">
							<small class="text-muted me-3">
								<i class="bi bi-eye"></i> {{ post.views_count }}
							</small>
							<small class="text-muted me-3">
								<i class="bi bi-heart"></i> {{ post.likes_count }}
							</small>
							<small class="text-muted">
								<i class="bi bi-chat"></i> {{ post.comments|length }}
							</small>
						</div>
						<small class="text-muted">{{ post.created_at.strftime('%b %d') }}</small>
					</div>
				</div>
				<div class="card-footer bg-transparent">
					<div class="d-flex justify-content-between align-items-center">
						<small class="text-muted">by {{ post.author.name or post.author.username }}</small>
						<a href="{{ url_for('posts.detail', post_id=post.id) }}" class="btn btn-sm btn-primary">Read</a>
					</div>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
	{% else %}
	<div class="text-center py-5">
		<i class="bi bi-lock display-1 text-muted"></i>
		<h4 class="mt-3">No Private Posts Yet</h4>
		<p class="text-muted">Create your first private post to keep your thoughts secure.</p>
		<a href="{{ url_for('posts.new_post') }}" class="btn btn-primary">Create Private Post</a>
	</div>
	{% endif %}

	<!-- Private Categories Section -->
	{% if categories %}
	<div class="mt-5">
		<h4>Your Private Categories</h4>
		<div class="row row-cols-1 row-cols-md-3 g-3">
			{% for category in categories %}
			<div class="col">
				<div class="card">
					<div class="card-body text-center">
						<h5 class="card-title">{{ category.name }}</h5>
						<p class="card-text">
							<span class="badge bg-primary">{{ category.posts|length }} posts</span>
						</p>
						<a href="{{ url_for('main.private_section', category=category.name) }}" class="btn btn-sm btn-outline-primary">View Posts</a>
					</div>
				</div>
			</div>
			{% endfor %}
		</div>
	</div>
	{% endif %}
</div>
{% endblock %}